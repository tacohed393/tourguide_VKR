import asyncio
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker
from sqlalchemy import text

# –ò–º–ø–æ—Ä—Ç—ã
from app.core.config import settings
from app.models.place import Place
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–≤–æ—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
from app.services.ml_service import get_embedding

PLACE_IMAGES ={}
TEST_PLACES = [
    # --- –ú–û–°–ö–í–ê ---
    {
        "name": "–ö—Ä–∞—Å–Ω–∞—è –ü–ª–æ—â–∞–¥—å",
        "city": "Moscow",
        "type": "–ú—É–∑–µ–π",
        "price": "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
        "lat": 55.753930, "lon": 37.620795,
        "image_url": "http://localhost:8000/static/images/defautl_img_1.jpg",
        "description": "–°–µ—Ä–¥—Ü–µ –†–æ—Å—Å–∏–∏, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ú–æ—Å–∫–≤—ã —Å –≤–∏–¥–æ–º –Ω–∞ –ö—Ä–µ–º–ª—å –∏ –°–æ–±–æ—Ä –í–∞—Å–∏–ª–∏—è –ë–ª–∞–∂–µ–Ω–Ω–æ–≥–æ.",
        "context": "–ö—Ä–∞—Å–Ω–∞—è –ü–ª–æ—â–∞–¥—å. –ì–ª–∞–≤–Ω–∞—è –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–æ–≥—É–ª–∫–∏, –±—Ä—É—Å—á–∞—Ç–∫–∞, –º–∞–≤–∑–æ–ª–µ–π –õ–µ–Ω–∏–Ω–∞, –ì–£–ú, –º–æ—Ä–æ–∂–µ–Ω–æ–µ, —Å—É–≤–µ–Ω–∏—Ä—ã, –∑–∏–º–∞, –∫–∞—Ç–æ–∫, —è—Ä–º–∞—Ä–∫–∞, —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞."
    },
    {
        "name": "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ",
        "city": "Moscow",
        "type": "–ü–∞—Ä–∫",
        "price": "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
        "lat": 55.729462, "lon": 37.601323,
        "image_url": "http://localhost:8000/static/images/defautl_img_1.jpg",
        "description": "–ì–ª–∞–≤–Ω—ã–π –ø–∞—Ä–∫ —Å—Ç–æ–ª–∏—Ü—ã. –ò–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞, —Å–ø–æ—Ä—Ç–∞ –∏ –ø–∏–∫–Ω–∏–∫–æ–≤ –Ω–∞ –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π.",
        "context": "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ. –ü—Ä–∏—Ä–æ–¥–∞, –¥–µ—Ä–µ–≤—å—è, –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è –ú–æ—Å–∫–≤—ã-—Ä–µ–∫–∏, –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã, —Å–∞–º–æ–∫–∞—Ç—ã, –ø—Ä–æ–≥—É–ª–∫–∞ —Å –¥–µ—Ç—å–º–∏, —Å–≤–∏–¥–∞–Ω–∏–µ, –ª–µ—Ç–æ, –æ—Ç–¥—ã—Ö, –ø–∏–∫–Ω–∏–∫, –∫–∞—Ç–∞–º–∞—Ä–∞–Ω—ã. –ï—Å—Ç—å –µ–¥–∞, –±—É—Ä–≥–µ—Ä—ã, –∫–æ—Ñ–µ."
    },
    {
        "name": "–î–µ–ø–æ.–ú–æ—Å–∫–≤–∞",
        "city": "Moscow",
        "type": "–ö–∞—Ñ–µ",
        "price": "–°—Ä–µ–¥–Ω–∏–π",
        "lat": 55.729462, "lon": 37.601323,
        "image_url": "http://localhost:8000/static/images/defautl_img_1.jpg",
        "description": "–ö—Ä—É–ø–Ω–µ–π—à–∏–π —Ñ—É–¥–º–æ–ª–ª –≤ –ï–≤—Ä–æ–ø–µ. –ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∫–≤–∞—Ä—Ç–∞–ª –≤ –∑–¥–∞–Ω–∏–∏ –±—ã–≤—à–µ–≥–æ —Ç—Ä–∞–º–≤–∞–π–Ω–æ–≥–æ –¥–µ–ø–æ.",
        "context": "–î–µ–ø–æ.–ú–æ—Å–∫–≤–∞. –ï–¥–∞, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –≥–∞—Å—Ç—Ä–æ–º–∞—Ä–∫–µ—Ç, —Ñ–∞—Å—Ç—Ñ—É–¥, –≤—ã—Å–æ–∫–∞—è –∫—É—Ö–Ω—è, –±–∞—Ä, –∫–æ–∫—Ç–µ–π–ª–∏, —Ç—É—Å–æ–≤–∫–∞, –∑–∞–≤—Ç—Ä–∞–∫, –æ–±–µ–¥, —É–∂–∏–Ω, –≤—Å—Ç—Ä–µ—á–∏ —Å –¥—Ä—É–∑—å—è–º–∏, —à—É–º–Ω–æ–µ –º–µ—Å—Ç–æ, –º–Ω–æ–≥–æ –ª—é–¥–µ–π, –≤–∫—É—Å–Ω–æ –ø–æ–µ—Å—Ç—å."
    },

    # --- –°–ê–ù–ö–¢-–ü–ï–¢–ï–†–ë–£–†–ì ---
    {
        "name": "–≠—Ä–º–∏—Ç–∞–∂",
        "city": "Saint Petersburg",
        "type": "–ú—É–∑–µ–π",
        "price": "–°—Ä–µ–¥–Ω–∏–π",
        "description": "–û–¥–∏–Ω –∏–∑ –≤–µ–ª–∏—á–∞–π—à–∏—Ö –º—É–∑–µ–µ–≤ –º–∏—Ä–∞ –≤ –ó–∏–º–Ω–µ–º –¥–≤–æ—Ä—Ü–µ. –ú–∏–ª–ª–∏–æ–Ω—ã —ç–∫—Å–ø–æ–Ω–∞—Ç–æ–≤ –∏—Å–∫—É—Å—Å—Ç–≤–∞.",
        "context": "–≠—Ä–º–∏—Ç–∞–∂. –ò—Å–∫—É—Å—Å—Ç–≤–æ, –∫–∞—Ä—Ç–∏–Ω—ã, –∏—Å—Ç–æ—Ä–∏—è, —Ü–∞—Ä–∏, –¥–≤–æ—Ä–µ—Ü, –∫—É–ª—å—Ç—É—Ä–∞, –¥–æ–∂–¥—å (—Å–ø—Ä—è—Ç–∞—Ç—å—Å—è –æ—Ç –ø–æ–≥–æ–¥—ã), —ç–∫—Å–∫—É—Ä—Å–∏—è, –¥–æ–ª–≥–æ —Ö–æ–¥–∏—Ç—å, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ. –í–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å –∫–∞—Ñ–µ."
    },
    {
        "name": "–°–µ–≤–∫–∞–±–µ–ª—å –ü–æ—Ä—Ç",
        "city": "Saint Petersburg",
        "type": "–ü–∞—Ä–∫",
        "price": "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
        "description": "–ú–æ–¥–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —É –º–æ—Ä—è –Ω–∞ –í–∞—Å–∏–ª—å–µ–≤—Å–∫–æ–º –æ—Å—Ç—Ä–æ–≤–µ. –í–∏–¥ –Ω–∞ –∑–∞–ª–∏–≤, –≤—ã—Å—Ç–∞–≤–∫–∏ –∏ –±–∞—Ä—ã.",
        "context": "–°–µ–≤–∫–∞–±–µ–ª—å –ü–æ—Ä—Ç. –ú–æ—Ä–µ, –§–∏–Ω—Å–∫–∏–π –∑–∞–ª–∏–≤, –∑–∞–∫–∞—Ç, —Ä–æ–º–∞–Ω—Ç–∏–∫–∞, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ, –≤—ã—Å—Ç–∞–≤–∫–∏, –∫–æ–Ω—Ü–µ—Ä—Ç—ã, –≤–µ—á–µ—Ä–∏–Ω–∫–∏, –∫–∞—Ç–æ–∫ –∑–∏–º–æ–π, –±–∞—Ä—ã, —Å—Ç—Ä–∏—Ç—Ñ—É–¥, –º–æ–ª–æ–¥–µ–∂–Ω–æ–µ –º–µ—Å—Ç–æ, —Ö–∏–ø—Å—Ç–µ—Ä—ã."
    },
    {
        "name": "–£–ª–∏—Ü–∞ –†—É–±–∏–Ω—à—Ç–µ–π–Ω–∞",
        "city": "Saint Petersburg",
        "type": "–ë–∞—Ä",
        "price": "–ü—Ä–µ–º–∏—É–º",
        "description": "–ì–ª–∞–≤–Ω–∞—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–∞—è —É–ª–∏—Ü–∞ –≥–æ—Ä–æ–¥–∞. –ë–∞—Ä–Ω–∞—è –ª–∏–Ω–∏—è —Å –¥–µ—Å—è—Ç–∫–∞–º–∏ –∑–∞–≤–µ–¥–µ–Ω–∏–π –Ω–∞ –ª—é–±–æ–π –≤–∫—É—Å.",
        "context": "–£–ª–∏—Ü–∞ –†—É–±–∏–Ω—à—Ç–µ–π–Ω–∞. –ë–∞—Ä—ã, –∞–ª–∫–æ–≥–æ–ª—å, –≤–µ—á–µ—Ä–∏–Ω–∫–∞, –Ω–æ—á—å, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –≤–∫—É—Å–Ω–∞—è –µ–¥–∞, –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞, —Ç—É—Å–æ–≤–∫–∞, –ø—Ä–æ–≥—É–ª–∫–∞, –≤—ã–ø–∏—Ç—å, –∫–æ–∫—Ç–µ–π–ª–∏, –º—É–∑—ã–∫–∞, —Ü–µ–Ω—Ç—Ä."
    },

    # --- –û–ú–°–ö ---
    {
        "name": "Skuratov Coffee (–§–ª–∞–≥–º–∞–Ω)",
        "city": "Omsk",
        "type": "–ö–∞—Ñ–µ",
        "price": "–°—Ä–µ–¥–Ω–∏–π",
        "description": "–†–æ–¥–∏–Ω–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç—ã—Ö –±—Ä—é-–±–∞—Ä–æ–≤. –°—Ç–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—å–µ—Ä, –æ—Ç–ª–∏—á–Ω—ã–π –∫–æ—Ñ–µ –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã.",
        "context": "Skuratov Coffee (–§–ª–∞–≥–º–∞–Ω). –ö–æ—Ñ–µ, –∫–æ—Ñ–µ–π–Ω—è, –∑–∞–≤—Ç—Ä–∞–∫, —Ä–∞–±–æ—Ç–∞ —Å –Ω–æ—É—Ç–±—É–∫–æ–º, —Ñ—Ä–∏–ª–∞–Ω—Å, —Å–ø–æ–∫–æ–π–Ω–æ–µ –º–µ—Å—Ç–æ, –≤–∫—É—Å–Ω—ã–π –¥–µ—Å–µ—Ä—Ç, –∫—Ä—É–∞—Å—Å–∞–Ω—ã, —ç–π—Ä –ª–∞—Ç—Ç–µ, –∫–æ–ª–¥ –±—Ä—é, –≤—Å—Ç—Ä–µ—á–∞, —É—é—Ç."
    },
    {
        "name": "–û–º—Å–∫–∞—è –ö—Ä–µ–ø–æ—Å—Ç—å",
        "city": "Omsk",
        "type": "–ú—É–∑–µ–π",
        "price": "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
        "description": "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–ª–µ–∫—Å –Ω–∞ –±–µ—Ä–µ–≥—É –ò—Ä—Ç—ã—à–∞. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ –∏ –∑–¥–∞–Ω–∏—è 18-19 –≤–µ–∫–æ–≤.",
        "context": "–û–º—Å–∫–∞—è –ö—Ä–µ–ø–æ—Å—Ç—å. –ò—Å—Ç–æ—Ä–∏—è, –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ò—Ä—Ç—ã—à, —Ä–µ–∫–∞, –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è, –ø—Ä–æ–≥—É–ª–∫–∏, —ç–∫—Å–∫—É—Ä—Å–∏–∏, –¢–æ–±–æ–ª—å—Å–∫–∏–µ –≤–æ—Ä–æ—Ç–∞, –ø–∞–º—è—Ç–Ω–∏–∫, –∫—É–ª—å—Ç—É—Ä–∞, —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞, —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è."
    },
    {
        "name": "–ü—Ç–∏—á—å—è –ì–∞–≤–∞–Ω—å",
        "city": "Omsk",
        "type": "–ü–∞—Ä–∫",
        "price": "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ",
        "description": "–ü—Ä–∏—Ä–æ–¥–Ω—ã–π –ø–∞—Ä–∫ –≤ —á–µ—Ä—Ç–µ –≥–æ—Ä–æ–¥–∞. –û–∑–µ—Ä–∞, –ø–µ—Ä–µ–ª–µ—Ç–Ω—ã–µ –ø—Ç–∏—Ü—ã –∏ —Ç–∏—à–∏–Ω–∞.",
        "context": "–ü—Ç–∏—á—å—è –ì–∞–≤–∞–Ω—å. –ü—Ä–∏—Ä–æ–¥–∞, —ç–∫–æ–ª–æ–≥–∏—è, –ø–∞—Ä–∫, –ø—Ç–∏—Ü—ã, –∂–∏–≤–æ—Ç–Ω—ã–µ, —Ç–∏—à–∏–Ω–∞, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, –ø—Ä–æ–≥—É–ª–∫–∞ —Å –¥–µ—Ç—å–º–∏, —Å–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö, –æ–∑–µ—Ä–æ, –æ—Å–µ–Ω—å, –ª–µ—Ç–æ, –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ."
    }
]

async def seed_data():
    print("üöÄ –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    
    engine = create_async_engine(settings.DATABASE_URL)
    SessionLocal = async_sessionmaker(engine, expire_on_commit=False)

    async with SessionLocal() as db:
        await db.execute(text("TRUNCATE TABLE places RESTART IDENTITY"))
        
        for data in TEST_PLACES:
            print(f"Adding: {data['name']}...")
            
            # –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç
            text_for_vector = f"{data['description']} {data.get('context', '')}"
            
            # –í–ê–ñ–ù–û: –î–æ–±–∞–≤–∏–ª–∏ await, —Ç–∞–∫ –∫–∞–∫ —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è async
            vector = await get_embedding(text_for_vector)
            
            place = Place(
                name=data["name"],
                city=data["city"],
                type=data["type"],
                price=data["price"],
                description=data["description"],
                lat=data.get("lat"), 
                lon=data.get("lon"), 
                image_url=data.get("image_url"), 
                search_context=text_for_vector,
                embedding=vector
            )
            db.add(place)
        
        await db.commit()
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!")
    
    await engine.dispose()

if __name__ == "__main__":
    asyncio.run(seed_data())